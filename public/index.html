<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vinted Sold Items</title>
  <style>
    body { font-family: sans-serif; background:#f2f2f2; margin:0; padding:0;}
    #salesContainer { display:flex; flex-wrap: wrap; padding:10px; gap:10px;}
    .sold-item { background:white; padding:10px; border-radius:8px; width:200px; text-align:center; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
    .sold-item img { width:100%; border-radius:6px;}
    .sold-item a { color:inherit; text-decoration:none;}
  </style>
</head>
<body>
  <h1 style="text-align:center; padding:10px;">Sold Items Dashboard</h1>
  <div id="salesContainer"></div>

  <script>
    async function loadSales() {
      const res = await fetch('/sales');
      const sales = await res.json();
      const container = document.getElementById('salesContainer');
      container.innerHTML = '';

      sales.sort((a,b) => {
        const durationA = new Date(a.soldAt) - new Date(a.startedAt);
        const durationB = new Date(b.soldAt) - new Date(b.startedAt);
        return durationA - durationB; // fastest selling first
      });

      for(const item of sales){
        const div = document.createElement('div');
        div.className = 'sold-item';
        div.innerHTML = `
          <a href="${item.link}" target="_blank">
            <img src="${item.image || ''}" alt="${item.name}">
            <p><strong>${item.name}</strong></p>
            <p>${item.price}</p>
            <p>Sold in: ${Math.round((new Date(item.soldAt)-new Date(item.startedAt))/1000)}s</p>
          </a>
        `;
        container.appendChild(div);
      }
    }

    loadSales();
    setInterval(loadSales, 10000);
  </script>
</body>
</html>
